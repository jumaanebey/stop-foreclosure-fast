<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>California Foreclosure Help Online - Virtual Consultation & Cash Offers | My Foreclosure Solution</title>
    <meta name="description" content="California's leading online foreclosure specialists. Virtual consultations, remote cash offers, serve all CA counties. Licensed professionals since 2014. Free online consultation.">
    <meta name="keywords" content="foreclosure help California online, virtual foreclosure consultation California, online cash offer California, remote foreclosure assistance, California foreclosure specialist, foreclosure help statewide CA">
    <meta name="author" content="My Foreclosure Solution">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://myforeclosuresolution.com/">
    <meta property="og:title" content="Stop Foreclosure in 7 Days - My Foreclosure Solution">
    <meta property="og:description" content="Facing foreclosure? Get a fair cash offer in 24 hours. We buy houses in ANY condition and close in 7 days. No fees, no commissions.">
    <meta property="og:image" content="https://myforeclosuresolution.com/images/hero-image.svg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://myforeclosuresolution.com/">
    <meta property="twitter:title" content="Stop Foreclosure in 7 Days - My Foreclosure Solution">
    <meta property="twitter:description" content="Facing foreclosure? Get a fair cash offer in 24 hours. We buy houses in ANY condition and close in 7 days.">
    <meta property="twitter:image" content="https://myforeclosuresolution.com/images/hero-image.svg">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "My Foreclosure Solution",
      "url": "https://myforeclosuresolution.com",
      "telephone": "+1-949-328-4811",
      "email": "help@myforeclosuresolution.com",
      "description": "Licensed real estate professionals helping homeowners avoid foreclosure since 2014. We buy houses in any condition and close in 7 days.",
      "serviceArea": "California",
      "areaServed": [
        "Los Angeles",
        "San Diego", 
        "San Francisco",
        "Sacramento",
        "Orange County",
        "Riverside",
        "San Bernardino",
        "Ventura County"
      ],
      "priceRange": "Free consultation",
      "openingHours": "Mo-Fr 08:00-20:00, Sa 09:00-17:00",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "reviewCount": "127"
      }
    }
    </script>
    
    <!-- Google Fonts -->
    <!-- Performance Optimization -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.google-analytics.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Google Calendar Appointment Scheduling -->
    <link href="https://calendar.google.com/calendar/scheduling-button-script.css" rel="stylesheet">
    <script src="https://calendar.google.com/calendar/scheduling-button-script.js" async></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZC3FHFTPN2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZC3FHFTPN2');
    </script>
    
    <!-- Facebook Pixel -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window,document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', 'YOUR_PIXEL_ID'); // Replace with your Facebook Pixel ID
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none" 
             src="https://www.facebook.com/tr?id=YOUR_PIXEL_ID&ev=PageView&noscript=1"/>
    </noscript>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo"><a href="/" onclick="location.reload(); return false;">My Foreclosure Solution</a></h1>
            <nav class="nav">
                <a href="virtual-consultation.html">Virtual Consultation</a>
                <a href="california-foreclosure-help.html">All CA Counties</a>
                <a href="foreclosure-faq.html">FAQ</a>
                <button class="ai-assistant-btn" onclick="openAIAssistant()">ü§ñ AI Assistant</button>
                <a href="tel:+1-949-328-4811" class="cta-button">Call (949) 328-4811</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">California's Leading Online Foreclosure Specialists</h1>
                <h2 class="hero-subtitle">Virtual Consultations ‚Ä¢ Remote Cash Offers ‚Ä¢ Serving All 58 CA Counties Since 2014</h2>
                <p class="hero-description">
                    Facing foreclosure anywhere in California? Get expert help from home. We provide virtual consultations, remote property evaluations, and online cash offers. 
                    Licensed professionals serving the entire state - no need to drive anywhere. Get started with a free online consultation today.
                </p>
                <div class="hero-cta">
                    <a href="sms:+1-949-328-4811?body=EMERGENCY: I need immediate virtual foreclosure help anywhere in California. Please call me ASAP!" class="cta-button-large" onclick="handleEmergencyButtonClick(); gtag('event', 'emergency_foreclosure_help', {'event_category': 'urgent_lead'});" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.3);">
                        üìû Emergency Virtual Consultation
                    </a>
                    <a href="cash-offer-calculator.html" class="cta-button-secondary" onclick="gtag('event', 'calculator_click', {'event_category': 'engagement'});">
                        üíª Get Online Cash Offer
                    </a>
                </div>
            </div>
            <div class="hero-image">
                <img src="images/hero-image.svg" alt="Happy family saved from foreclosure" width="500" height="400">
            </div>
        </div>
    </section>

    <!-- Trust Indicators -->
    <section class="trust-indicators">
        <div class="container">
            <h2>Why Homeowners Trust Us</h2>
            <div class="trust-grid">
                <div class="trust-item">
                    <div class="trust-icon">üè†</div>
                    <h3>10+ Years Experience</h3>
                    <p>Licensed real estate professionals helping homeowners since 2014</p>
                </div>
                <div class="trust-item">
                    <div class="trust-icon">üí∞</div>
                    <h3>No Hidden Fees</h3>
                    <p>We pay all closing costs. You get the full cash amount we agree on</p>
                </div>
                <div class="trust-item">
                    <div class="trust-icon">‚ö°</div>
                    <h3>Fast Closing</h3>
                    <p>Close in 7 days or on your timeline. Stop foreclosure immediately</p>
                </div>
                <div class="trust-item">
                    <div class="trust-icon">üõ°Ô∏è</div>
                    <h3>Professional Service</h3>
                    <p>Licensed real estate professionals providing transparent, honest solutions</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section id="how-it-works" class="foreclosure-process-section">
        <div class="container">
            <h2 class="process-main-title">How We Stop Your Foreclosure</h2>
            <div class="foreclosure-steps-grid">
                <article class="foreclosure-step-card">
                    <div class="step-circle-number">1</div>
                    <h3 class="step-card-title">Call or Submit Info</h3>
                    <p class="step-card-description">Tell us about your situation. We'll review your options in 15 minutes or less.</p>
                </article>
                <article class="foreclosure-step-card">
                    <div class="step-circle-number">2</div>
                    <h3 class="step-card-title">Get Cash Offer</h3>
                    <p class="step-card-description">We'll make you a fair, no-obligation cash offer within 24 hours.</p>
                </article>
                <article class="foreclosure-step-card">
                    <div class="step-circle-number">3</div>
                    <h3 class="step-card-title">Close Fast</h3>
                    <p class="step-card-description">Accept our offer and we can close in 7 days. Foreclosure stopped.</p>
                </article>
            </div>
        </div>
    </section>

    <!-- Urgency Section -->
    <section class="urgency">
        <div class="container">
            <h2>Time is Running Out</h2>
            <p class="urgency-text">
                Every day you wait, you lose more options. Foreclosure can be stopped, but only if you act now. 
                Don't let the bank take your home when you have other choices.
            </p>
            <div class="urgency-cta">
                <a href="sms:+1-949-328-4811?body=URGENT: I need immediate help with foreclosure. Please contact me ASAP." class="cta-button-large" onclick="gtag('event', 'urgent_text', {'event_category': 'engagement'});">
                    üö® Stop Foreclosure Now - Text (949) 328-4811
                </a>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials">
        <div class="container">
            <h2>Real Stories from Homeowners We've Helped</h2>
            <div class="testimonials-placeholder">
                <div class="testimonial-template">
                    <div class="testimonial-content">
                        <h3>What Our Clients Say</h3>
                        <p><em>Real client testimonials will be featured here once we begin serving customers. We're committed to providing excellent service and building trust through proven results.</em></p>
                        <div class="testimonial-features">
                            <div class="feature">‚úÖ Licensed professionals</div>
                            <div class="feature">‚úÖ No obligation consultations</div>
                            <div class="feature">‚úÖ Fast response times</div>
                            <div class="feature">‚úÖ Multiple solution options</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="testimonial-stats">
                <div class="stat">
                    <div class="stat-number">10+</div>
                    <div class="stat-label">Years Experience</div>
                </div>
                <div class="stat">
                    <div class="stat-number">CA</div>
                    <div class="stat-label">Licensed Professionals</div>
                </div>
                <div class="stat">
                    <div class="stat-number">7</div>
                    <div class="stat-label">Day Target Closing</div>
                </div>
                <div class="stat">
                    <div class="stat-number">Free</div>
                    <div class="stat-label">Consultation</div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about">
        <div class="container">
            <h2>About My Foreclosure Solution</h2>
            <div class="about-content">
                <div class="about-text">
                    <p>
                        We're a family-owned real estate investment company that specializes in helping homeowners 
                        facing foreclosure. Since 2014, we've been helping families avoid foreclosure and 
                        move on with their lives.
                    </p>
                    <p>
                        Our team of licensed real estate professionals understands the stress and uncertainty 
                        you're facing. We provide honest, transparent solutions with no hidden fees or commissions.
                    </p>
                    <div class="credentials">
                        <div class="credential">‚úì Licensed Real Estate Professionals</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Lead Magnet Section -->
    <section class="lead-magnet-section">
        <div class="container">
            <div class="lead-magnet-content">
                <div class="lead-magnet-text">
                    <h2>üìã Free Download: California Foreclosure Timeline Checklist</h2>
                    <p class="lead-magnet-description">
                        Get our comprehensive guide showing exactly what happens during California foreclosure 
                        and the critical deadlines you need to know. This checklist has helped over 200+ 
                        homeowners understand their options and take action.
                    </p>
                    <div class="lead-magnet-benefits">
                        <div class="benefit">‚úÖ Step-by-step foreclosure timeline</div>
                        <div class="benefit">‚úÖ Key deadlines and your rights</div>
                        <div class="benefit">‚úÖ Action steps to take immediately</div>
                        <div class="benefit">‚úÖ Local California resources</div>
                    </div>
                </div>
                <div class="lead-magnet-form">
                    <form id="lead-magnet-form" class="lead-capture-form">
                        <h3>Get Your Free Checklist Now</h3>
                        <div class="form-group">
                            <input type="text" id="lead-name" name="name" placeholder="Your First Name" required>
                        </div>
                        <div class="form-group">
                            <input type="email" id="lead-email" name="email" placeholder="Your Email Address" required>
                        </div>
                        <div class="form-group">
                            <input type="text" id="lead-city" name="city" placeholder="Your City (Optional)">
                        </div>
                        <button type="submit" class="lead-magnet-button" onclick="gtag('event', 'lead_magnet_download', {'event_category': 'lead'});">
                            üì• Download Free Checklist
                        </button>
                        <p class="privacy-text">
                            100% free. No spam. We respect your privacy.
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact">
        <div class="container">
            <h2>Get Your Free Cash Offer Today</h2>
            <p>Fill out the form below and we'll contact you within 2 hours during business hours with your options.</p>
            
            <form id="contact-form" class="contact-form" action="contact-form.html" method="POST">
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label for="address">Property Address</label>
                    <input type="text" id="address" name="address" placeholder="123 Main St, City, State">
                </div>
                
                <div class="form-group">
                    <label for="situation">Describe Your Situation</label>
                    <textarea id="situation" name="situation" rows="4" placeholder="Tell us about your foreclosure timeline and any other details..."></textarea>
                </div>
                
                <button type="submit" class="submit-button" onclick="gtag('event', 'form_submit', {'event_category': 'lead'});">
                    Get My Free Cash Offer
                </button>
                
                <p class="privacy-text">
                    Your information is 100% secure and will never be shared with third parties.
                </p>
            </form>
        </div>
    </section>

    <!-- Calendar Scheduling Section -->
    <section id="schedule" class="calendar-section">
        <div class="container">
            <h2>Schedule Your Free Video Consultation</h2>
            <p>Book a 15-minute video call to discuss your foreclosure situation and explore your options.</p>
            
            <div class="calendar-container">
                <div class="calendar-info">
                    <h3>What to Expect:</h3>
                    <ul>
                        <li>‚úÖ Free 15-minute video consultation</li>
                        <li>‚úÖ Review your foreclosure timeline</li>
                        <li>‚úÖ Discuss your options</li>
                        <li>‚úÖ Get preliminary cash offer estimate</li>
                        <li>‚úÖ No obligation or pressure</li>
                    </ul>
                    <div class="booking-requirements">
                        <p><strong>Required for video call booking:</strong></p>
                        <ul>
                            <li>üìû Your phone number (required)</li>
                            <li>üìß Email address (required)</li>
                            <li>üè† Property address (if comfortable sharing)</li>
                            <li>üíª Video meeting link will be sent via email</li>
                        </ul>
                    </div>
                </div>
                
                <div class="calendar-embed">
                    <div class="calendar-button-container">
                        <div id="google-calendar-button">
                            <!-- Google Calendar Button will load here -->
                            <script>
                            (function() {
                              var target = document.getElementById('google-calendar-button');
                              window.addEventListener('load', function() {
                                calendar.schedulingButton.load({
                                  url: 'https://calendar.google.com/calendar/appointments/schedules/AcZssZ11saPKXhTtJ5jLw6q9XASJXT6whF2LSN7MgXGzcT9PIlyRhXWXVVIDKqsIojgwkJo76HPcFLSz?gv=true',
                                  color: '#1a365d',
                                  label: 'Schedule Your Free Video Call',
                                  target: target,
                                });
                              });
                            })();
                            </script>
                        </div>
                        
                        <div style="text-align: center; margin-top: var(--space-lg); padding: var(--space-lg); background: var(--gray-50); border-radius: var(--radius-lg);">
                            <p style="color: var(--gray-600); margin-bottom: var(--space-md);"><strong>Prefer to text first?</strong></p>
                            <a href="sms:+1-949-328-4811?body=I'd like to schedule a video consultation about my foreclosure situation." class="cta-button-large">üí¨ Text (949) 328-4811</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>My Foreclosure Solution</h3>
                    <p>Licensed California Real Estate Professional</p>
                    <p>DRE License #02076038</p>
                    <p>üìû (949) 328-4811</p>
                    <p>üìß help@myforeclosuresolution.com</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="#how-it-works">How It Works</a>
                    <a href="#about">About Us</a>
                    <a href="#contact">Contact</a>
                    <a href="blog/index.html">Foreclosure Help Blog</a>
                    <a href="privacy-policy.html">Privacy Policy</a>
                    <a href="terms-of-service.html">Terms of Service</a>
                </div>
                <div class="footer-section">
                    <h4>California Resources</h4>
                    <a href="blog/california-foreclosure-timeline.html">CA Foreclosure Timeline</a>
                    <a href="blog/stop-foreclosure-los-angeles.html">Los Angeles Help</a>
                    <a href="blog/california-foreclosure-laws.html">CA Foreclosure Laws</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 My Foreclosure Solution. All rights reserved.</p>
                <p>Licensed Real Estate Professional DRE #02076038 | NMLS #2033637 | Equal Housing Opportunity</p>
            </div>
        </div>
    </footer>

    <!-- Emergency Contact Popup -->
    <div id="emergency-contact-popup" class="exit-popup-overlay" style="display: none;">
        <div class="exit-popup-content">
            <div class="exit-popup-close" onclick="closeEmergencyPopup()">&times;</div>
            
            <div class="exit-popup-header">
                <h2>üö® Emergency Foreclosure Help</h2>
                <p class="exit-popup-subtitle">
                    We respond to <strong>urgent foreclosure situations within 2 hours</strong>. 
                    Fill out this form and we'll call you immediately.
                </p>
            </div>
            
            <div class="exit-popup-body">
                <form id="emergency-contact-form" class="exit-popup-form">
                    <div class="exit-form-group">
                        <input type="text" id="emergency-name" name="name" placeholder="Your Full Name" required>
                    </div>
                    <div class="exit-form-group">
                        <input type="email" id="emergency-email" name="email" placeholder="Your Email Address" required>
                    </div>
                    <div class="exit-form-group">
                        <input type="tel" id="emergency-phone" name="phone" placeholder="Your Phone Number" required>
                    </div>
                    <div class="exit-form-group">
                        <input type="text" id="emergency-address" name="property_address" placeholder="Property Address (Optional)">
                    </div>
                    <div class="exit-form-group">
                        <label style="color: #1f2937; font-weight: 600; margin-bottom: 0.5rem; display: block;">Select all that apply to your situation:</label>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 0.5rem; text-align: left;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="received_notice_of_default" style="margin: 0;">
                                üìÑ I received a Notice of Default
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="auction_scheduled" style="margin: 0;">
                                üèõÔ∏è My home is scheduled for auction
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="missed_payments" style="margin: 0;">
                                üí∞ I'm behind on mortgage payments
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="less_than_30_days" style="margin: 0;">
                                ‚è∞ I have less than 30 days before auction
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="need_to_sell_quickly" style="margin: 0;">
                                üè† I need to sell my house quickly
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="other_financial_hardship" style="margin: 0;">
                                üí∏ Other financial hardship situation
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="exit-popup-button" style="background: #dc2626;">
                        üìû Get Emergency Help Now
                    </button>
                    <p class="exit-privacy-text">
                        <strong>We'll call you within 2 hours during business hours.</strong> Your information is 100% secure.
                    </p>
                </form>
            </div>
        </div>
    </div>

    <!-- Exit Intent Popup -->
    <div id="exit-intent-popup" class="exit-popup-overlay" style="display: none;">
        <div class="exit-popup-content">
            <div class="exit-popup-close" onclick="closeExitPopup()">&times;</div>
            
            <div class="exit-popup-header">
                <h2>‚ö†Ô∏è Wait! Don't Let the Bank Take Your Home</h2>
                <p class="exit-popup-subtitle">
                    Get our <strong>free California Foreclosure Timeline Checklist</strong> before you go. 
                    Know your rights and deadlines.
                </p>
            </div>
            
            <div class="exit-popup-body">
                <div class="exit-popup-benefits">
                    <div class="exit-benefit">‚úÖ Step-by-step foreclosure timeline</div>
                    <div class="exit-benefit">‚úÖ Critical deadlines you need to know</div>
                    <div class="exit-benefit">‚úÖ Your legal rights at each phase</div>
                    <div class="exit-benefit">‚úÖ Emergency contacts and resources</div>
                </div>
                
                <form id="exit-popup-form" class="exit-popup-form">
                    <div class="exit-form-group">
                        <input type="text" id="exit-name" name="name" placeholder="Your First Name" required>
                    </div>
                    <div class="exit-form-group">
                        <input type="email" id="exit-email" name="email" placeholder="Your Email Address" required>
                    </div>
                    <div class="exit-form-group">
                        <label style="color: #1f2937; font-weight: 600; margin-bottom: 0.5rem; display: block;">Select all that apply to your situation:</label>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 0.4rem; text-align: left;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="received_notice_of_default" style="margin: 0;">
                                üìÑ I received a Notice of Default
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="auction_scheduled" style="margin: 0;">
                                üèõÔ∏è My home is scheduled for auction
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="missed_payments" style="margin: 0;">
                                üí∞ I'm behind on mortgage payments
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="less_than_30_days" style="margin: 0;">
                                ‚è∞ I have less than 30 days before auction
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="need_to_sell_quickly" style="margin: 0;">
                                üè† I need to sell my house quickly
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="situation" value="other_financial_hardship" style="margin: 0;">
                                üí∏ Other financial hardship situation
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="exit-popup-button" onclick="gtag('event', 'exit_intent_lead', {'event_category': 'lead'});">
                        üì• Get My Free Checklist Now
                    </button>
                    <p class="exit-privacy-text">
                        100% free. We'll never spam you. Unsubscribe anytime.
                    </p>
                </form>
            </div>
            
            <div class="exit-popup-footer">
                <p class="exit-social-proof">
                    <strong>Join 200+ homeowners</strong> who used this checklist to understand their options and avoid foreclosure.
                </p>
            </div>
        </div>
    </div>

    <script defer src="js/script.js"></script>
    
    <!-- Advanced Analytics & Lead Scoring System -->
    <script>
    // Global tracking variables
    let sessionData = {
        startTime: Date.now(),
        pageViews: 1,
        engagement: {
            scrollDepth: 0,
            timeOnPage: 0,
            interactionEvents: [],
            formInteractions: 0,
            phoneClicks: 0,
            consultationInterest: false
        }
    };

    // Enhanced Virtual Consultation Tracking
    function trackVirtualConsultationFunnel(stage, data = {}) {
        gtag('event', 'virtual_consultation_funnel', {
            'event_category': 'Virtual Consultation',
            'event_label': stage,
            'consultation_type': data.type || 'standard',
            'urgency_level': data.urgency || 'normal',
            'county': data.county || 'unknown',
            'device_type': data.device || getDeviceType(),
            'traffic_source': data.source || getTrafficSource(),
            'value': data.value || 0,
            'session_id': getSessionId()
        });
        
        // Update lead score in real-time
        updateLeadScore(stage, data);
    }

    // Lead Scoring System
    function calculateLeadScore() {
        let score = 0;
        
        // Engagement scoring
        if (sessionData.engagement.timeOnPage > 300) score += 15; // 5+ minutes
        if (sessionData.engagement.scrollDepth > 75) score += 10;
        if (sessionData.engagement.formInteractions > 0) score += 25;
        if (sessionData.engagement.phoneClicks > 0) score += 30;
        if (sessionData.engagement.consultationInterest) score += 40;
        
        // Page view scoring
        if (sessionData.pageViews > 3) score += 15;
        if (sessionData.pageViews > 5) score += 20;
        
        // Source quality scoring
        const source = getTrafficSource();
        const sourceScores = {
            'google_organic': 25,
            'google_my_business': 30,
            'referral': 35,
            'social_media': 15,
            'direct': 20
        };
        score += sourceScores[source] || 10;
        
        return Math.min(score, 200); // Cap base engagement score at 200
    }

    function updateLeadScore(event, data) {
        const eventScores = {
            'page_view': 5,
            'form_interaction': 15,
            'form_completion': 50,
            'phone_click': 25,
            'consultation_page_view': 20,
            'emergency_button_click': 40,
            'download_resource': 20
        };
        
        const eventScore = eventScores[event] || 0;
        const totalScore = calculateLeadScore() + eventScore;
        
        // Store score locally for session
        sessionStorage.setItem('leadScore', totalScore);
        
        // Send to CRM if available
        if (typeof sendToCRM === 'function') {
            sendToCRM({
                event: event,
                score: totalScore,
                timestamp: new Date().toISOString(),
                data: data
            });
        }
        
        // Trigger automated actions based on score thresholds
        triggerScoreBasedActions(totalScore);
    }

    function triggerScoreBasedActions(score) {
        // Hot lead threshold (100+ points)
        if (score >= 100 && !sessionStorage.getItem('hotLeadTriggered')) {
            sessionStorage.setItem('hotLeadTriggered', 'true');
            
            // Show priority consultation offer
            setTimeout(() => {
                if (!document.getElementById('priority-consultation-popup')) {
                    showPriorityConsultationPopup();
                }
            }, 5000);
        }
        
        // Warm lead threshold (75+ points)
        else if (score >= 75 && !sessionStorage.getItem('warmLeadTriggered')) {
            sessionStorage.setItem('warmLeadTriggered', 'true');
            
            // Show resource download offer
            setTimeout(() => {
                if (!sessionStorage.getItem('resourceOffered')) {
                    showResourceDownloadOffer();
                }
            }, 10000);
        }
    }

    // Core Web Vitals Tracking
    function trackWebVitals() {
        // Largest Contentful Paint
        new PerformanceObserver((entryList) => {
            for (const entry of entryList.getEntries()) {
                gtag('event', 'web_vitals', {
                    event_category: 'Web Vitals',
                    event_label: 'LCP',
                    value: Math.round(entry.startTime),
                    non_interaction: true,
                });
            }
        }).observe({entryTypes: ['largest-contentful-paint']});

        // First Input Delay
        new PerformanceObserver((entryList) => {
            for (const entry of entryList.getEntries()) {
                gtag('event', 'web_vitals', {
                    event_category: 'Web Vitals',
                    event_label: 'FID',
                    value: Math.round(entry.processingStart - entry.startTime),
                    non_interaction: true,
                });
            }
        }).observe({entryTypes: ['first-input']});

        // Cumulative Layout Shift
        new PerformanceObserver((entryList) => {
            let clsValue = 0;
            for (const entry of entryList.getEntries()) {
                if (!entry.hadRecentInput) {
                    clsValue += entry.value;
                }
            }
            gtag('event', 'web_vitals', {
                event_category: 'Web Vitals',
                event_label: 'CLS',
                value: Math.round(clsValue * 1000),
                non_interaction: true,
            });
        }).observe({entryTypes: ['layout-shift']});
    }

    // Enhanced user behavior tracking
    function initializeBehaviorTracking() {
        // Scroll depth tracking
        let maxScrollDepth = 0;
        window.addEventListener('scroll', () => {
            const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
            if (scrollPercent > maxScrollDepth) {
                maxScrollDepth = Math.round(scrollPercent);
                sessionData.engagement.scrollDepth = maxScrollDepth;
                
                // Track scroll milestones
                if (maxScrollDepth >= 25 && !sessionStorage.getItem('scroll25')) {
                    sessionStorage.setItem('scroll25', 'true');
                    gtag('event', 'scroll_milestone', {
                        event_category: 'Engagement',
                        event_label: '25_percent',
                        value: 25
                    });
                }
                if (maxScrollDepth >= 50 && !sessionStorage.getItem('scroll50')) {
                    sessionStorage.setItem('scroll50', 'true');
                    gtag('event', 'scroll_milestone', {
                        event_category: 'Engagement',
                        event_label: '50_percent',
                        value: 50
                    });
                }
                if (maxScrollDepth >= 75 && !sessionStorage.getItem('scroll75')) {
                    sessionStorage.setItem('scroll75', 'true');
                    gtag('event', 'scroll_milestone', {
                        event_category: 'Engagement',
                        event_label: '75_percent',
                        value: 75
                    });
                    updateLeadScore('scroll_75', {scrollDepth: 75});
                }
            }
        });

        // Time on page tracking
        setInterval(() => {
            sessionData.engagement.timeOnPage = Date.now() - sessionData.startTime;
            
            // Track time milestones
            const minutes = Math.floor(sessionData.engagement.timeOnPage / 60000);
            if (minutes >= 2 && !sessionStorage.getItem('time2min')) {
                sessionStorage.setItem('time2min', 'true');
                gtag('event', 'time_milestone', {
                    event_category: 'Engagement',
                    event_label: '2_minutes',
                    value: 2
                });
                updateLeadScore('time_2min', {timeOnPage: minutes});
            }
            if (minutes >= 5 && !sessionStorage.getItem('time5min')) {
                sessionStorage.setItem('time5min', 'true');
                gtag('event', 'time_milestone', {
                    event_category: 'Engagement',
                    event_label: '5_minutes',
                    value: 5
                });
                updateLeadScore('time_5min', {timeOnPage: minutes});
            }
        }, 30000); // Check every 30 seconds

        // Form interaction tracking
        document.addEventListener('focusin', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                sessionData.engagement.formInteractions++;
                
                if (sessionData.engagement.formInteractions === 1) {
                    gtag('event', 'form_start', {
                        event_category: 'Form Interaction',
                        event_label: e.target.closest('form').id || 'unknown_form'
                    });
                    updateLeadScore('form_interaction', {formId: e.target.closest('form').id});
                }
            }
        });

        // Phone click tracking
        document.querySelectorAll('a[href^="tel:"]').forEach(link => {
            link.addEventListener('click', function() {
                sessionData.engagement.phoneClicks++;
                gtag('event', 'phone_click', {
                    event_category: 'Contact Attempt',
                    event_label: 'phone_number',
                    value: 25
                });
                updateLeadScore('phone_click', {phoneNumber: this.href});
            });
        });

        // Consultation interest tracking
        document.querySelectorAll('a[href*="consultation"], button[onclick*="consultation"], a[href*="schedule"]').forEach(element => {
            element.addEventListener('click', function() {
                sessionData.engagement.consultationInterest = true;
                gtag('event', 'consultation_interest', {
                    event_category: 'Virtual Consultation',
                    event_label: 'interest_shown',
                    value: 40
                });
                updateLeadScore('consultation_interest', {element: this.textContent});
            });
        });
    }

    // Utility functions
    function getDeviceType() {
        const width = window.innerWidth;
        if (width <= 768) return 'mobile';
        if (width <= 1024) return 'tablet';
        return 'desktop';
    }

    function getTrafficSource() {
        const referrer = document.referrer;
        const urlParams = new URLSearchParams(window.location.search);
        
        if (urlParams.get('utm_source')) {
            return urlParams.get('utm_source');
        }
        
        if (referrer.includes('google.com')) return 'google_organic';
        if (referrer.includes('facebook.com')) return 'facebook';
        if (referrer.includes('linkedin.com')) return 'linkedin';
        if (referrer.includes('google.com/maps') || referrer.includes('business.google.com')) return 'google_my_business';
        if (referrer && !referrer.includes(window.location.hostname)) return 'referral';
        if (!referrer) return 'direct';
        
        return 'unknown';
    }

    function getSessionId() {
        let sessionId = sessionStorage.getItem('sessionId');
        if (!sessionId) {
            sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('sessionId', sessionId);
        }
        return sessionId;
    }

    // Priority consultation popup for hot leads
    function showPriorityConsultationPopup() {
        const popup = document.createElement('div');
        popup.id = 'priority-consultation-popup';
        popup.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
            align-items: center; justify-content: center;
        `;
        
        popup.innerHTML = `
            <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 500px; margin: 1rem;">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <h3 style="color: #dc2626; margin-bottom: 0.5rem;">üéØ Priority Consultation Available</h3>
                    <p>Based on your interest, you qualify for a priority virtual consultation within 4 hours.</p>
                </div>
                <div style="text-align: center;">
                    <a href="virtual-consultation.html" onclick="gtag('event', 'priority_consultation_click', {'event_category': 'hot_lead'});" 
                       style="background: #dc2626; color: white; padding: 1rem 2rem; border-radius: 0.5rem; 
                              text-decoration: none; font-weight: 600; margin-right: 1rem;">
                        üìÖ Book Priority Consultation
                    </a>
                    <button onclick="this.closest('#priority-consultation-popup').remove()" 
                            style="background: #6b7280; color: white; padding: 1rem 2rem; border: none; 
                                   border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
                        Maybe Later
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(popup);
        
        // Auto-remove after 30 seconds
        setTimeout(() => {
            if (document.getElementById('priority-consultation-popup')) {
                popup.remove();
            }
        }, 30000);
    }

    // Initialize all tracking systems
    document.addEventListener('DOMContentLoaded', function() {
        trackWebVitals();
        initializeBehaviorTracking();
        
        // Track page view for virtual consultation funnel
        trackVirtualConsultationFunnel('page_view', {
            type: 'homepage',
            value: 1
        });
        
        // Initialize lead scoring
        updateLeadScore('page_view', {
            page: 'homepage',
            timestamp: new Date().toISOString()
        });
    });
    </script>

    <!-- AI Assistant Modal -->
    <div id="ai-assistant-modal" class="ai-modal" style="display: none;">
        <div class="ai-modal-content">
            <div class="ai-modal-header">
                <h3>ü§ñ AI Foreclosure Assistant</h3>
                <p>Get instant analysis of your foreclosure situation</p>
                <span class="ai-modal-close" onclick="closeAIAssistant()">&times;</span>
            </div>
            
            <div class="ai-modal-body">
                <div id="chatbot-container" class="chatbot-container">
                    <!-- Chat messages will appear here -->
                    <div id="chat-messages" class="chat-messages">
                        <div class="ai-message-bubble">
                            <div class="ai-avatar">ü§ó</div>
                            <div class="message-content">
                                <p>Hi there! I'm here to help you understand your foreclosure situation and connect you with the right support.</p>
                                <p>Let's start with a simple question:</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Current question/slide -->
                    <div id="current-slide" class="current-slide">
                        <!-- Dynamic content based on current step -->
                    </div>
                    
                    <!-- Hidden data collection -->
                    <div id="chatbot-data" style="display: none;">
                        <input type="hidden" id="cb-situation" value="">
                        <input type="hidden" id="cb-urgency" value="">
                        <input type="hidden" id="cb-timeline" value="">
                        <input type="hidden" id="cb-name" value="">
                        <input type="hidden" id="cb-phone" value="">
                        <input type="hidden" id="cb-email" value="">
                        <input type="hidden" id="cb-property" value="">
                        <input type="hidden" id="cb-score" value="0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating AI Chat Button -->
    <div class="ai-floating-btn" onclick="openAIAssistant()" title="AI Foreclosure Assistant">
        <div class="ai-btn-content">
            <span class="ai-emoji">ü§ñ</span>
            <span class="ai-btn-text">AI Help</span>
        </div>
        <div class="ai-pulse"></div>
    </div>

    <!-- AI Assistant Styles -->
    <style>
        /* AI Assistant Button in Navigation */
        .ai-assistant-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .ai-assistant-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* Floating AI Button */
        .ai-floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .ai-floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }

        .ai-btn-content {
            text-align: center;
            color: white;
        }

        .ai-emoji {
            font-size: 24px;
            display: block;
        }

        .ai-btn-text {
            font-size: 10px;
            font-weight: 600;
            margin-top: 2px;
        }

        .ai-pulse {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }

        /* AI Modal Styles */
        .ai-modal {
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.2);
            display: flex;
            align-items: stretch;
            justify-content: flex-end;
        }

        .ai-modal-content {
            background: white;
            border-radius: 15px 0 0 15px;
            width: 45%;
            max-width: 600px;
            min-width: 500px;
            height: 100vh;
            overflow-y: auto;
            position: relative;
            animation: slideInFromRight 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.2);
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes modalSlideIn {
            from {
                transform: scale(0.7);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .ai-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px 0 0 0;
            position: relative;
            flex-shrink: 0;
        }

        .ai-modal-header h3 {
            margin: 0;
            font-size: 26px;
        }

        .ai-modal-header p {
            margin: 8px 0 0 0;
            opacity: 0.9;
            font-size: 16px;
        }

        .ai-modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: white;
            line-height: 1;
        }

        .ai-modal-body {
            padding: 25px;
        }

        .ai-welcome-message {
            background: #f8fafc;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        .ai-message {
            font-size: 14px;
            line-height: 1.6;
        }

        .ai-message ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .ai-message li {
            margin: 5px 0;
        }

        .ai-input-area {
            margin: 20px 0;
        }

        .ai-input-area textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }

        .ai-input-area textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .ai-analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            width: 100%;
        }

        .ai-analyze-btn:hover {
            opacity: 0.9;
        }

        .ai-features {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .ai-features h4 {
            margin-bottom: 15px;
            color: #374151;
        }

        .ai-quick-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 180px;
        }

        .ai-quick-btn.critical {
            background: #fef2f2;
            color: #dc2626;
            border: 2px solid #dc2626;
            font-weight: 700;
            animation: pulse-red 2s infinite;
        }

        .ai-quick-btn.urgent {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .ai-quick-btn.warning {
            background: #fefbeb;
            color: #d97706;
            border: 1px solid #fed7aa;
        }

        .ai-quick-btn.medium {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .ai-quick-btn.info {
            background: #f0f9ff;
            color: #0369a1;
            border: 1px solid #bae6fd;
        }

        .ai-quick-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .quick-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .or-divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }
        .or-divider:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e2e8f0;
        }
        .or-divider span {
            background: white;
            padding: 0 20px;
            color: #6b7280;
            font-weight: 600;
            font-size: 14px;
        }
        
        @keyframes pulse-red {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
        }

        .ai-chat-messages {
            min-height: 100px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
            display: none;
        }

        .ai-response {
            background: #e0f2fe;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #0284c7;
        }

        .ai-score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
        }

        .ai-score-number {
            font-size: 24px;
            font-weight: 700;
            display: block;
        }

        .ai-recommendations {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .ai-recommendations h5 {
            color: #166534;
            margin-bottom: 10px;
        }

        .ai-recommendations ul {
            margin: 0;
            padding-left: 20px;
        }

        .ai-recommendations li {
            color: #166534;
            margin: 5px 0;
        }

        /* New Chatbot Styles */
        .chatbot-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f8fafc;
            min-height: 250px;
        }

        .ai-message-bubble {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            animation: slideInLeft 0.3s ease;
        }

        .user-message-bubble {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-direction: row-reverse;
            animation: slideInRight 0.3s ease;
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-left: 15px;
            flex-shrink: 0;
            color: white;
        }

        .message-content {
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 70%;
            line-height: 1.5;
        }

        .user-message-content {
            background: #0ea5e9;
            color: white;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 70%;
            line-height: 1.5;
        }

        .current-slide {
            background: white;
            padding: 25px;
            border-top: 1px solid #e5e7eb;
            border-radius: 0 0 0 15px;
            min-height: 320px;
            flex-shrink: 0;
        }

        .slide-question {
            font-size: 20px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .slide-options {
            display: grid;
            gap: 18px;
        }

        .slide-option {
            padding: 18px 22px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-weight: 600;
            font-size: 16px;
            line-height: 1.5;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .slide-option:hover {
            border-color: #0ea5e9;
            background: #f0f9ff;
            transform: translateY(-2px);
        }

        .slide-option.urgent {
            border-color: #fecaca;
            background: #fef2f2;
        }

        .slide-option.urgent:hover {
            border-color: #dc2626;
            background: #fef2f2;
        }

        .slide-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            margin: 10px 0;
            transition: border-color 0.3s ease;
        }

        .slide-input:focus {
            outline: none;
            border-color: #0ea5e9;
        }

        .slide-button {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .slide-button:hover {
            background: #0284c7;
            transform: translateY(-2px);
        }

        .urgency-indicator {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            margin-left: 10px;
        }

        .urgency-critical {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
            animation: pulse 2s infinite;
        }

        .urgency-high {
            background: #fff7ed;
            color: #ea580c;
            border: 1px solid #fed7aa;
        }

        .urgency-medium {
            background: #fefbeb;
            color: #d97706;
            border: 1px solid #fcd34d;
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            gap: 8px;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: #0ea5e9;
            transform: scale(1.5);
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .quick-options-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .ai-quick-btn {
                min-width: 100%;
                padding: 15px 20px;
            }
            .scoring-reference div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
            .ai-floating-btn {
                bottom: 15px;
                right: 15px;
                width: 55px;
                height: 55px;
            }

            .ai-emoji {
                font-size: 20px;
            }

            .ai-btn-text {
                font-size: 9px;
            }

            .ai-modal {
                justify-content: center;
                align-items: center;
            }
            .ai-modal-content {
                width: 95%;
                max-width: 500px;
                height: 90vh;
                border-radius: 15px;
                margin: 20px;
                box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            }
            .ai-modal-header {
                border-radius: 15px 15px 0 0;
            }
            .current-slide {
                border-radius: 0 0 15px 15px;
            }

            .ai-assistant-btn {
                display: none; /* Hide in nav on mobile, use floating button */
            }
        }
    </style>

    <!-- AI Assistant JavaScript -->
    <script>
        console.log('ü§ñ AI Assistant JavaScript loading...');
        
        // Define functions immediately so they're available for onclick handlers
        function openAIAssistant() {
            console.log('AI Assistant button clicked');
            const modal = document.getElementById('ai-assistant-modal');
            console.log('Modal element found:', modal);
            
            if (modal) {
                modal.style.display = 'flex';
                startChatbot(); // Initialize the chatbot
                console.log('Modal opened and chatbot started');
            } else {
                console.error('AI Assistant modal not found!');
                alert('AI Assistant modal not found. Please refresh the page.');
                return;
            }
            
            // Track AI assistant opening
            if (typeof gtag !== 'undefined') {
                gtag('event', 'ai_chatbot_opened', {
                    'event_category': 'AI Interaction',
                    'event_label': 'Chatbot Started'
                });
            }
        }

        // Make function globally available
        window.openAIAssistant = openAIAssistant;
        console.log('‚úÖ openAIAssistant function defined and assigned to window');

        function closeAIAssistant() {
            console.log('Closing AI Assistant modal');
            const modal = document.getElementById('ai-assistant-modal');
            if (modal) {
                modal.style.display = 'none';
                console.log('Modal hidden');
            }
        }

        // Make function globally available
        window.closeAIAssistant = closeAIAssistant;
        console.log('‚úÖ closeAIAssistant function defined and assigned to window');
        
        // Test function availability
        console.log('Function test:', typeof window.openAIAssistant, typeof window.closeAIAssistant);
        
        // Add to global scope for debugging
        window.testAI = function() {
            console.log('Test function called - AI functions available:', typeof window.openAIAssistant);
            return typeof window.openAIAssistant === 'function';
        };
        
        // Force show modal for debugging
        window.forceShowModal = function() {
            const modal = document.getElementById('ai-assistant-modal');
            console.log('Modal element:', modal);
            if (modal) {
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                console.log('Modal forced to show - computed style:', window.getComputedStyle(modal).display);
            } else {
                console.error('Modal not found!');
            }
        };

        // Chatbot system
        let currentStep = 1;
        let chatbotData = {};
        let urgencyPath = 'slow'; // 'slow' or 'fast'

        function startChatbot() {
            currentStep = 1;
            chatbotData = {};
            showStep1();
        }

        function showStep1() {
            updateProgressDots(1, 5);
            document.getElementById('current-slide').innerHTML = `
                <div class="slide-question">What best describes your current situation?</div>
                <div class="slide-options">
                    <div class="slide-option urgent" onclick="selectSituation('auction', 'fast')">
                        üö® My home is scheduled for auction/sale
                    </div>
                    <div class="slide-option urgent" onclick="selectSituation('default', 'fast')">
                        ‚ö†Ô∏è I received a notice of default
                    </div>
                    <div class="slide-option" onclick="selectSituation('behind', 'slow')">
                        üí∞ I'm behind on mortgage payments
                    </div>
                    <div class="slide-option" onclick="selectSituation('hardship', 'slow')">
                        üíî I'm facing financial hardship
                    </div>
                    <div class="slide-option" onclick="selectSituation('exploring', 'slow')">
                        ü§î I'm exploring my options
                    </div>
                </div>
            `;
        }

        function selectSituation(situation, path) {
            chatbotData.situation = situation;
            urgencyPath = path;
            
            addUserMessage(getSituationText(situation));
            addAIMessage(getSituationResponse(situation, path));
            
            setTimeout(() => {
                currentStep = 2;
                showStep2();
            }, 1500);
        }

        function showStep2() {
            updateProgressDots(2, 5);
            
            if (urgencyPath === 'fast') {
                document.getElementById('current-slide').innerHTML = `
                    <div class="slide-question">When do you need to take action? <span class="urgency-indicator urgency-critical">URGENT</span></div>
                    <div class="slide-options">
                        <div class="slide-option urgent" onclick="selectTimeline('days', 'CRITICAL_RISK')">
                            üö® Days - Auction is very soon
                        </div>
                        <div class="slide-option urgent" onclick="selectTimeline('weeks', 'CRITICAL_RISK')">
                            ‚ö†Ô∏è Weeks - I have some time but not much
                        </div>
                        <div class="slide-option" onclick="selectTimeline('month', 'HIGH_RISK')">
                            üìÖ About a month
                        </div>
                        <div class="slide-option" onclick="selectTimeline('unsure', 'HIGH_RISK')">
                            ü§∑ I'm not sure of the timeline
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('current-slide').innerHTML = `
                    <div class="slide-question">How urgent do you feel your situation is?</div>
                    <div class="slide-options">
                        <div class="slide-option" onclick="selectTimeline('urgent', 'HIGH_RISK')">
                            ‚ö° Very urgent - need help soon
                        </div>
                        <div class="slide-option" onclick="selectTimeline('concerned', 'MODERATE_RISK')">
                            üòü Concerned but have some time
                        </div>
                        <div class="slide-option" onclick="selectTimeline('planning', 'MODERATE_RISK')">
                            üìã Planning ahead
                        </div>
                        <div class="slide-option" onclick="selectTimeline('exploring', 'EARLY_STAGE')">
                            üîç Just exploring options
                        </div>
                    </div>
                `;
            }
        }

        function selectTimeline(timeline, riskLevel) {
            chatbotData.timeline = timeline;
            chatbotData.riskLevel = riskLevel;
            chatbotData.score = getRiskScore(riskLevel);  // Keep score for backward compatibility
            
            addUserMessage(getTimelineText(timeline));
            addAIMessage(getTimelineResponse(timeline, urgencyPath));
            
            setTimeout(() => {
                currentStep = 3;
                showStep3();
            }, 1500);
        }

        function showStep3() {
            updateProgressDots(3, 5);
            document.getElementById('current-slide').innerHTML = `
                <div class="slide-question">To provide the best help, I'd like to know your name:</div>
                <input type="text" class="slide-input" id="step3-name" placeholder="Your first name" maxlength="50">
                <button class="slide-button" onclick="submitName()">Continue</button>
            `;
        }

        function submitName() {
            const name = document.getElementById('step3-name').value.trim();
            if (!name) {
                alert('Please enter your name to continue');
                return;
            }
            
            chatbotData.name = name;
            addUserMessage(name);
            addAIMessage(`Thank you ${name}! I want to make sure we can help you properly.`);
            
            setTimeout(() => {
                currentStep = 4;
                showStep4();
            }, 1500);
        }

        function showStep4() {
            updateProgressDots(4, 7);
            
            document.getElementById('current-slide').innerHTML = `
                <div class="slide-question">${chatbotData.name}, let me get your contact information:</div>
                <input type="tel" class="slide-input" id="step4-phone" placeholder="Phone number (555) 123-4567" required>
                <input type="email" class="slide-input" id="step4-email" placeholder="Email address" required>
                <button class="slide-button" onclick="submitContact()">Continue</button>
            `;
        }

        function submitContact() {
            const phone = document.getElementById('step4-phone').value.trim();
            const email = document.getElementById('step4-email').value.trim();
            
            if (!phone || !email) {
                alert('Please enter both your phone number and email address');
                return;
            }
            
            chatbotData.phone = phone;
            chatbotData.email = email;
            
            addUserMessage(`${phone} and ${email}`);
            addAIMessage("Perfect! Now let me get some details about your property.");
            
            setTimeout(() => {
                currentStep = 5;
                showStep5();
            }, 1500);
        }

        function showStep5() {
            updateProgressDots(5, 7);
            
            document.getElementById('current-slide').innerHTML = `
                <div class="slide-question">What's the full address of the property you need help with?</div>
                <input type="text" class="slide-input" id="step5-street" placeholder="Street Address">
                <div style="display: grid; grid-template-columns: 1fr 100px 100px; gap: 10px; margin-top: 10px;">
                    <input type="text" class="slide-input" id="step5-city" placeholder="City">
                    <input type="text" class="slide-input" id="step5-state" placeholder="State">
                    <input type="text" class="slide-input" id="step5-zip" placeholder="Zip Code">
                </div>
                <input type="text" class="slide-input" id="step5-value" placeholder="Estimated property value (optional)" style="margin-top: 10px;">
                <button class="slide-button" onclick="submitProperty()">Continue</button>
            `;
        }

        function submitProperty() {
            const street = document.getElementById('step5-street').value.trim();
            const city = document.getElementById('step5-city').value.trim();
            const state = document.getElementById('step5-state').value.trim();
            const zip = document.getElementById('step5-zip').value.trim();
            const value = document.getElementById('step5-value').value.trim();
            
            if (!street || !city || !state) {
                alert('Please enter the street address, city, and state');
                return;
            }
            
            const fullAddress = `${street}, ${city}, ${state}${zip ? ' ' + zip : ''}`;
            chatbotData.property = fullAddress;
            chatbotData.street = street;
            chatbotData.city = city;
            chatbotData.state = state;
            chatbotData.zip = zip;
            chatbotData.propertyValue = value;
            
            addUserMessage(fullAddress + (value ? ` (Est. value: ${value})` : ''));
            addAIMessage("Thank you! Last question - when would be the best time for a consultation appointment?");
            
            setTimeout(() => {
                currentStep = 6;
                showStep6();
            }, 1500);
        }

        function showStep6() {
            updateProgressDots(6, 7);
            
            if (chatbotData.riskLevel === 'CRITICAL_RISK' || chatbotData.riskLevel === 'HIGH_RISK') {
                document.getElementById('current-slide').innerHTML = `
                    <div class="slide-question">When can you schedule an emergency consultation appointment? <span class="urgency-indicator urgency-critical">URGENT</span></div>
                    <div class="slide-options">
                        <div class="slide-option urgent" onclick="selectMeetingTime('asap')">
                            üö® As soon as possible today
                        </div>
                        <div class="slide-option urgent" onclick="selectMeetingTime('within-hours')">
                            ‚ö° Within the next few hours
                        </div>
                        <div class="slide-option" onclick="selectMeetingTime('tomorrow')">
                            üìÖ Tomorrow morning
                        </div>
                        <div class="slide-option" onclick="selectMeetingTime('this-week')">
                            üìÜ Sometime this week
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('current-slide').innerHTML = `
                    <div class="slide-question">When would work best for a consultation appointment?</div>
                    <div class="slide-options">
                        <div class="slide-option" onclick="selectMeetingTime('this-week')">
                            üìÖ This week
                        </div>
                        <div class="slide-option" onclick="selectMeetingTime('next-week')">
                            üìÜ Next week
                        </div>
                        <div class="slide-option" onclick="selectMeetingTime('flexible')">
                            ü§ù I'm flexible
                        </div>
                        <div class="slide-option" onclick="selectMeetingTime('evenings')">
                            üåÖ Evenings work best
                        </div>
                    </div>
                `;
            }
        }

        function getMeetingTimeText(timeframe) {
            const texts = {
                'asap': 'As soon as possible today',
                'within-hours': 'Within the next few hours', 
                'tomorrow': 'Tomorrow morning',
                'this-week': 'This week',
                'next-week': 'Next week',
                'flexible': 'I\'m flexible with timing',
                'evenings': 'Evenings work best for appointments'
            };
            return texts[timeframe] || timeframe;
        }
        
        function getRiskScore(riskLevel) {
            const scores = {
                'CRITICAL_RISK': 450,
                'HIGH_RISK': 350,
                'MODERATE_RISK': 250,
                'EARLY_STAGE': 150
            };
            return scores[riskLevel] || 150;
        }

        function selectMeetingTime(timeframe) {
            chatbotData.meetingTime = timeframe;
            
            addUserMessage(getMeetingTimeText(timeframe));
            addAIMessage("Perfect! Let me schedule your consultation appointment.");
            
            setTimeout(() => {
                currentStep = 7;
                showFinalStep();
            }, 1500);
        }

        function showFinalStep() {
            updateProgressDots(7, 7);
            
            const urgencyLevel = chatbotData.riskLevel?.toLowerCase().replace('_', '-') || 'early-stage';
            
            addAIMessage(getFinalMessage(urgencyLevel, chatbotData.name));
            
            // Submit lead to dashboard
            submitLeadToDashboard();
            
            if (chatbotData.riskLevel === 'CRITICAL_RISK' || chatbotData.riskLevel === 'HIGH_RISK') {
                document.getElementById('current-slide').innerHTML = `
                    <div style="padding: 20px;">
                        <h3 style="color: #0369a1; margin: 0 0 20px 0; text-align: center;">üóìÔ∏è Schedule Your Emergency Consultation</h3>
                        <p style="color: #374151; margin-bottom: 20px; text-align: center;">
                            <strong>${chatbotData.name}</strong>, please select your preferred appointment time:
                        </p>
                        <div id="calendar-container">
                            ${generateCalendar()}
                        </div>
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #0ea5e9;">
                            <p style="margin: 0; color: #0369a1; font-size: 14px;">
                                üìß Confirmation will be sent to: ${chatbotData.email}<br>
                                üè† Property: ${chatbotData.property}<br>
                                ‚ö° Emergency Priority - Same day scheduling available
                            </p>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('current-slide').innerHTML = `
                    <div style="padding: 20px;">
                        <h3 style="color: #065f46; margin: 0 0 20px 0; text-align: center;">üóìÔ∏è Schedule Your Consultation Appointment</h3>
                        <p style="color: #374151; margin-bottom: 20px; text-align: center;">
                            <strong>${chatbotData.name}</strong>, please select your preferred appointment time:
                        </p>
                        <div id="calendar-container">
                            ${generateCalendar(false)}
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #10b981;">
                            <p style="margin: 0; color: #065f46; font-size: 14px;">
                                üìß Confirmation will be sent to: ${chatbotData.email}<br>
                                üè† Property: ${chatbotData.property}<br>
                                üìÖ Standard appointment scheduling
                            </p>
                        </div>
                    </div>
                `;
            }
        }

        // Google Calendar integration for appointment scheduling
        function generateCalendar(isEmergency = true) {
            // Use your existing Google Calendar appointment scheduling
            const calendarUrl = 'https://calendar.google.com/calendar/appointments/schedules/AcZssZ11saPKXhTtJ5jLw6q9XASJXT6whF2LSN7MgXGzcT9PIlyRhXWXVVIDKqsIojgwkJo76HPcFLSz?gv=true';
            
            const urgencyMessage = isEmergency 
                ? '<div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid #dc2626; margin-bottom: 20px;">' +
                     '<p style="margin: 0; color: #dc2626; font-weight: 600;">üö® Emergency Priority Scheduling</p>' +
                     '<p style="margin: 5px 0 0 0; color: #991b1b; font-size: 14px;">Same-day appointments available. Please mention this is an emergency consultation when booking.</p>' +
                   '</div>'
                : '<div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 20px;">' +
                     '<p style="margin: 0; color: #065f46; font-weight: 600;">üìÖ Standard Consultation Scheduling</p>' +
                     '<p style="margin: 5px 0 0 0; color: #047857; font-size: 14px;">Select a convenient time for your foreclosure consultation.</p>' +
                   '</div>';
            
            return urgencyMessage +
                '<div id="chatbot-google-calendar" style="margin: 20px 0;">' +
                    '<div style="text-align: center; margin-bottom: 15px;">' +
                        '<p style="color: #374151; margin: 0;">Click the button below to access your available appointment times:</p>' +
                    '</div>' +
                    '<div id="google-calendar-chatbot-button" style="display: flex; justify-content: center;"></div>' +
                '</div>' +
                '<div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 20px;">' +
                    '<p style="margin: 0; color: #6b7280; font-size: 14px; text-align: center;">' +
                        'After booking, your appointment will be confirmed automatically and you\'ll receive calendar invitations.' +
                    '</p>' +
                '</div>' +
                '<script>' +
                    'setTimeout(function() {' +
                        'var calendarUrl = "' + calendarUrl + '";' +
                        'var isEmergency = ' + isEmergency + ';' +
                        'if (window.calendar && window.calendar.schedulingButton) {' +
                            'window.calendar.schedulingButton.load({' +
                                'url: calendarUrl,' +
                                'color: isEmergency ? "#dc2626" : "#0ea5e9",' +
                                'label: isEmergency ? "üö® Schedule Emergency Consultation" : "üìÖ Schedule Consultation",' +
                                'target: document.getElementById("google-calendar-chatbot-button"),' +
                            '});' +
                        '} else {' +
                            'document.getElementById("google-calendar-chatbot-button").innerHTML = ' +
                                '"<a href=\\"" + calendarUrl + "\\" target=\\"_blank\\" class=\\"slide-button\\" style=\\"background: " + (isEmergency ? "#dc2626" : "#0ea5e9") + "; display: inline-block; text-decoration: none;\\">" + (isEmergency ? "üö® Schedule Emergency Consultation" : "üìÖ Schedule Consultation") + "</a>";' +
                        '}' +
                    '}, 500);' +
                '</script>';
        }
        
        // Note: Google Calendar handles appointment selection directly
        // Lead data is automatically saved when user completes the chatbot flow
        
        async function submitLeadToDashboard() {
            try {
                // Prepare complete lead data for dashboard
                const leadData = {
                    name: chatbotData.name,
                    phone: chatbotData.phone,
                    email: chatbotData.email || '',
                    property_address: chatbotData.property || '',
                    street_address: chatbotData.street || '',
                    city: chatbotData.city || '',
                    state: chatbotData.state || '',
                    zip_code: chatbotData.zip || '',
                    property_value: chatbotData.propertyValue || '',
                    best_time: getMeetingTimeText(chatbotData.meetingTime) || '',
                    appointment_method: 'google_calendar',
                    appointment_status: 'ready_to_schedule',
                    urgency_level: urgencyPath === 'fast' ? 'emergency' : 'standard',
                    lead_source: 'ai_chatbot_with_calendar',
                    ai_situation: `${chatbotData.situation} - ${chatbotData.timeline}`,
                    risk_level: chatbotData.riskLevel,
                    risk_score: getRiskScore(chatbotData.riskLevel) / 100,
                    ai_score: chatbotData.score,
                    keywords_detected: ['google_calendar_ready', 'complete_chatbot_flow'],
                    timestamp: new Date().toISOString()
                };
                
                const response = await fetch('https://stop-foreclosure-fast.onrender.com/api/ai/emergency-booking', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(leadData)
                });
                
                const result = await response.json();
                console.log('‚úÖ Lead created in dashboard:', result);
                console.log('üìä Lead data sent:', leadData);
                
                return result;
                
            } catch (error) {
                console.error('‚ùå Failed to create lead in dashboard:', error);
                return null;
            }
        }

        // Helper functions for chatbot
        function addUserMessage(text) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'user-message-bubble';
            messageDiv.innerHTML = `
                <div class="user-avatar">üë§</div>
                <div class="user-message-content">${text}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addAIMessage(text) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message-bubble';
            messageDiv.innerHTML = `
                <div class="ai-avatar">ü§ó</div>
                <div class="message-content">${text}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function updateProgressDots(current, total) {
            const progressContainer = document.getElementById('current-slide');
            let dots = '<div class="progress-dots">';
            for (let i = 1; i <= total; i++) {
                dots += `<div class="progress-dot ${i <= current ? 'active' : ''}"></div>`;
            }
            dots += '</div>';
            
            // Add dots at the top of the slide
            setTimeout(() => {
                const existingDots = document.querySelector('.progress-dots');
                if (existingDots) existingDots.remove();
                progressContainer.insertAdjacentHTML('afterbegin', dots);
            }, 100);
        }

        function getSituationText(situation) {
            const texts = {
                'auction': 'My home is scheduled for auction/sale',
                'default': 'I received a notice of default',
                'behind': 'I\'m behind on mortgage payments',
                'hardship': 'I\'m facing financial hardship',
                'exploring': 'I\'m exploring my options'
            };
            return texts[situation] || situation;
        }

        function getSituationResponse(situation, path) {
            if (path === 'fast') {
                return "I understand this is a very stressful situation. Let me ask a few quick questions to make sure you get the right help immediately.";
            } else {
                return "Thank you for sharing that with me. Let me learn a bit more about your situation so I can connect you with the best support.";
            }
        }

        function getTimelineText(timeline) {
            const texts = {
                'days': 'Days - Auction is very soon',
                'weeks': 'Weeks - I have some time but not much',
                'month': 'About a month',
                'unsure': 'I\'m not sure of the timeline',
                'urgent': 'Very urgent - need help soon',
                'concerned': 'Concerned but have some time',
                'planning': 'Planning ahead',
                'exploring': 'Just exploring options'
            };
            return texts[timeline] || timeline;
        }

        function getTimelineResponse(timeline, path) {
            if (path === 'fast' && ['days', 'weeks'].includes(timeline)) {
                return "This is definitely urgent. I want to make sure you get immediate help. Let me get your contact information so we can connect you with someone right away.";
            } else if (path === 'fast') {
                return "I understand you need help soon. Let me get your information so we can prioritize your case appropriately.";
            } else {
                return "That helps me understand your timeline. I want to make sure you get personalized attention.";
            }
        }

        function getFinalMessage(urgencyLevel, name) {
            if (urgencyLevel === 'critical') {
                return `${name}, based on our conversation, your situation requires immediate attention. I'm prioritizing your case for emergency response.`;
            } else if (urgencyLevel === 'high') {
                return `${name}, I can see you need help soon. I'm marking your case as high priority so you get quick attention.`;
            } else {
                return `${name}, thank you for sharing your situation with me. I'll make sure you're connected with the right specialist for your needs.`;
            }
        }


        // openAIAssistant function defined above

        // Legacy function - not used in new chatbot system
        function displayAIAnalysis(urgencyResult, scoreResult) {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const score = scoreResult.ai_score || 0;
            const urgencyLevel = urgencyResult.urgency_level;
            
            // Determine response timeline and urgency
            let responseTime, urgencyMessage, bookingRequired;
            
            if (score >= 400 || urgencyLevel === 'emergency') {
                responseTime = 'IMMEDIATE - Within 15 minutes';
                urgencyMessage = 'ü§ó We understand this is overwhelming - let\'s get you help immediately';
                bookingRequired = true;
            } else if (score >= 300 || urgencyLevel === 'high') {
                responseTime = 'URGENT - Within 1 hour';
                urgencyMessage = 'üíô You\'re not alone in this - we can help you through this crisis';
                bookingRequired = true;
            } else if (score >= 200 || urgencyLevel === 'medium') {
                responseTime = 'PRIORITY - Within 4 hours';
                urgencyMessage = 'üåü There are still good options available - let\'s explore them together';
                bookingRequired = true;
            } else {
                responseTime = 'Standard - Within 24 hours';
                urgencyMessage = 'üòä Great that you\'re being proactive - we\'re here to help';
                bookingRequired = false;
            }
            
            let html = `
                <div class="ai-response">
                    <div style="background: #f0f9ff; border-radius: 10px; padding: 20px; margin-bottom: 20px; border-left: 4px solid #0ea5e9;">
                        <h4 style="margin: 0 0 10px 0; color: #0369a1;">üíù Thank you for trusting us with your situation</h4>
                        <p style="margin: 0; color: #0369a1;">I've carefully analyzed your situation and want you to know that facing foreclosure is one of life's most stressful experiences. You're being brave by seeking help, and we're here to support you every step of the way.</p>
                    </div>
                    
                    <div class="urgency-header" style="background: ${getUrgencyBackgroundColor(score)}; color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                        <h4 style="margin: 0; font-size: 20px;">${urgencyMessage}</h4>
                        <div style="font-size: 24px; font-weight: bold; margin: 10px 0;">${score}/500 Urgency Score</div>
                        <div style="font-size: 14px; opacity: 0.9;">We recommend connecting: ${responseTime}</div>
                    </div>
                    
                    <div class="score-explanation" style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin: 20px 0; border-left: 4px solid ${getUrgencyBackgroundColor(score)};">
                        <h5 style="margin: 0 0 15px 0; color: #374151;">üìä What Your Score Means:</h5>
                        <div class="score-breakdown">
                            ${getScoreExplanation(score)}
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background: #fff; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <strong style="color: #dc2626;">‚è∞ Time is Critical:</strong> Higher scores mean you have less time to act. Our AI analyzed your keywords, timing, and situation to determine how quickly you need help.
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>Situation Analysis:</strong> <span style="color: ${getUrgencyColor(urgencyLevel)}">${urgencyLevel.toUpperCase()}</span><br>
                        <strong>Recommended Action:</strong> ${urgencyResult.action_required}
                    </div>
            `;

            if (urgencyResult.keywords_detected && urgencyResult.keywords_detected.length > 0) {
                html += `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 12px; margin: 15px 0;">
                        <strong>üîç Risk Factors Detected:</strong> ${urgencyResult.keywords_detected.join(', ')}
                    </div>
                `;
            }

            // Add scoring reference for all scores
            html += `
                <div class="scoring-reference" style="background: #f8fafc; border-radius: 10px; padding: 20px; margin: 20px 0; border: 1px solid #e2e8f0;">
                    <h5 style="margin: 0 0 15px 0; color: #374151;">üìà Complete Urgency Scale Reference:</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 13px;">
                        <div style="text-align: center; padding: 10px; background: #fef2f2; border-radius: 6px; border: 1px solid #fecaca;">
                            <div style="font-weight: 700; color: #dc2626;">400-500: CRITICAL</div>
                            <div style="color: #7f1d1d;">Days to save home</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #fff7ed; border-radius: 6px; border: 1px solid #fed7aa;">
                            <div style="font-weight: 700; color: #ea580c;">300-399: HIGH URGENCY</div>
                            <div style="color: #9a3412;">1-3 months to auction</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #fefbeb; border-radius: 6px; border: 1px solid #fcd34d;">
                            <div style="font-weight: 700; color: #d97706;">200-299: PRIORITY</div>
                            <div style="color: #92400e;">3-6 months to resolve</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f0fdf4; border-radius: 6px; border: 1px solid #bbf7d0;">
                            <div style="font-weight: 700; color: #059669;">0-199: STANDARD</div>
                            <div style="color: #065f46;">Not immediate crisis</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: center; color: #6b7280; font-size: 12px;">
                        üí° Your score determines how quickly you need to act to protect your home
                    </div>
                </div>
            `;

            if (bookingRequired) {
                html += `
                    <div class="appointment-booking" style="background: #f0f9ff; border-radius: 10px; padding: 25px; margin: 20px 0; border-left: 4px solid #0ea5e9;">
                        <h5 style="margin-top: 0; color: #0369a1;">üíù Let's Connect You with Help Right Away</h5>
                        <p style="margin: 10px 0; color: #0369a1; line-height: 1.6;">Your situation deserves immediate attention and care. We understand how overwhelming this must feel, and we want to connect you with one of our compassionate specialists who will listen to your unique situation and work with you to find the best path forward.</p>
                        <p style="margin: 15px 0; color: #0369a1; font-weight: 600;">Please share your contact information so we can reach out to you with support:</p>
                        
                        <div id="appointment-form" style="margin-top: 15px;">
                            <input type="text" id="contact-name" placeholder="Your Full Name *" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px;" required>
                            <input type="tel" id="contact-phone" placeholder="Phone Number *" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px;" required>
                            <input type="email" id="contact-email" placeholder="Email Address *" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px;" required>
                            <input type="text" id="property-address" placeholder="Property Address" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px;">
                            <select id="best-time" style="width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="">Best Time to Call</option>
                                <option value="now">RIGHT NOW - Emergency</option>
                                <option value="morning">Morning (8am-12pm)</option>
                                <option value="afternoon">Afternoon (12pm-5pm)</option>
                                <option value="evening">Evening (5pm-8pm)</option>
                            </select>
                            
                            <button onclick="scheduleEmergencyConsultation()" style="width: 100%; background: #0ea5e9; color: white; border: none; padding: 18px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 8px rgba(14, 165, 233, 0.3);">
                                üíô Yes, Please Connect Me with Help
                            </button>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div style="text-align: center; margin: 20px 0;">
                        <button onclick="window.open('tel:9493284811')" style="background: #1e40af; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                            üìû Call for Standard Consultation
                        </button>
                    </div>
                `;
            }

            if (scoreResult.recommendations) {
                html += `
                    <div class="ai-recommendations" style="margin-top: 20px;">
                        <h5>üí° Immediate Next Steps:</h5>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            ${scoreResult.recommendations.map(rec => `<li style="margin: 5px 0;">${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            html += '</div>';
            messagesContainer.innerHTML = html;
        }

        function quickAIAnalysis(type) {
            const situations = {
                auction: 'I received a notice of sale and my property is scheduled for auction next month. I need immediate help to stop the foreclosure sale.',
                notice_default: 'I received a notice of default from my lender and need to know my options before it goes to auction.',
                missed_payments: 'I am 3-4 months behind on my mortgage payments and received a letter from my lender about foreclosure.',
                job_loss: 'I lost my job 6 months ago and have been unable to make mortgage payments. I received foreclosure notices.',
                divorce: 'I am going through a divorce and cannot afford the mortgage payments on my own. I need to sell quickly.',
                medical: 'I have medical bills that prevented me from paying my mortgage and now I am facing foreclosure.',
                inherited: 'I inherited a property that I cannot afford to maintain and need to sell it quickly.',
                exploring: 'I want to explore my options before foreclosure proceedings begin and understand what help is available.',
                urgent: 'I received a notice of default and need immediate help with my foreclosure situation.',
                behind: 'I am behind on my mortgage payments and worried about foreclosure.'
            };

            document.getElementById('ai-input').value = situations[type];
            analyzeWithAI();
        }

        function getUrgencyColor(level) {
            switch(level) {
                case 'emergency': return '#dc2626';
                case 'high': return '#ea580c';
                case 'urgent': return '#d97706';
                case 'time_sensitive': return '#0369a1';
                case 'medium': return '#d97706';
                default: return '#059669';
            }
        }

        function getUrgencyBackgroundColor(score) {
            if (score >= 400) return '#dc2626'; // Red - Critical
            if (score >= 300) return '#ea580c'; // Orange - High
            if (score >= 200) return '#d97706'; // Yellow - Medium
            return '#059669'; // Green - Standard
        }

        function getScoreExplanation(score) {
            if (score >= 400) {
                return `
                    <div style="padding: 15px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
                        <div style="font-weight: 700; color: #dc2626; margin-bottom: 10px;">ü§ó Critical Situation - We're Here for You (400-500)</div>
                        <div style="color: #7f1d1d; margin-bottom: 8px;"><strong>Your situation:</strong> You're facing an immediate sale or auction of your home</div>
                        <div style="color: #7f1d1d; margin-bottom: 8px;"><strong>What this means:</strong> Every day matters - but there are still options to help you</div>
                        <div style="color: #7f1d1d; margin-bottom: 8px;"><strong>How we can help:</strong> We specialize in last-minute solutions and emergency interventions</div>
                        <div style="color: #dc2626; font-weight: 600;">üíô Let's connect within 15 minutes to protect your home and your family</div>
                    </div>
                `;
            } else if (score >= 300) {
                return `
                    <div style="padding: 15px; background: #fff7ed; border-radius: 8px; border: 1px solid #fed7aa;">
                        <div style="font-weight: 700; color: #ea580c; margin-bottom: 10px;">üíô High Priority - You Don't Have to Face This Alone (300-399)</div>
                        <div style="color: #9a3412; margin-bottom: 8px;"><strong>Your situation:</strong> You've received serious notices and time is becoming critical</div>
                        <div style="color: #9a3412; margin-bottom: 8px;"><strong>What this means:</strong> You still have several options, but acting quickly will give you the best outcomes</div>
                        <div style="color: #9a3412; margin-bottom: 8px;"><strong>How we can help:</strong> We can create a plan to address your situation and prevent foreclosure</div>
                        <div style="color: #ea580c; font-weight: 600;">üåü Let's talk within the hour and create a solution together</div>
                    </div>
                `;
            } else if (score >= 200) {
                return `
                    <div style="padding: 15px; background: #fefbeb; border-radius: 8px; border: 1px solid #fcd34d;">
                        <div style="font-weight: 700; color: #d97706; margin-bottom: 10px;">üåü Priority Support - Taking Action is Smart (200-299)</div>
                        <div style="color: #92400e; margin-bottom: 8px;"><strong>Your situation:</strong> You're experiencing financial challenges but being proactive</div>
                        <div style="color: #92400e; margin-bottom: 8px;"><strong>What this means:</strong> You have good options available and time to make informed decisions</div>
                        <div style="color: #92400e; margin-bottom: 8px;"><strong>How we can help:</strong> We can help you prevent problems from escalating and find the right solution</div>
                        <div style="color: #d97706; font-weight: 600;">üòä Let's connect within a few hours to explore your best options</div>
                    </div>
                `;
            } else {
                return `
                    <div style="padding: 15px; background: #f0fdf4; border-radius: 8px; border: 1px solid #bbf7d0;">
                        <div style="font-weight: 700; color: #059669; margin-bottom: 10px;">üòä Proactive Planning - You're Making a Wise Choice (0-199)</div>
                        <div style="color: #065f46; margin-bottom: 8px;"><strong>Your situation:</strong> You're being thoughtful and exploring your options early</div>
                        <div style="color: #065f46; margin-bottom: 8px;"><strong>What this means:</strong> You have time to make the best decision for your family's future</div>
                        <div style="color: #065f46; margin-bottom: 8px;"><strong>How we can help:</strong> We can provide expert guidance and help you understand all your options</div>
                        <div style="color: #059669; font-weight: 600;">üåà We're here when you're ready - let's talk at your convenience</div>
                    </div>
                `;
            }
        }

        async function scheduleEmergencyConsultation() {
            const name = document.getElementById('contact-name').value.trim();
            const phone = document.getElementById('contact-phone').value.trim();
            const email = document.getElementById('contact-email').value.trim();
            const address = document.getElementById('property-address').value.trim();
            const bestTime = document.getElementById('best-time').value;
            
            if (!name || !phone || !email) {
                alert('Please fill in all required fields (Name, Phone, Email)');
                return;
            }
            
            const appointmentData = {
                name: name,
                phone: phone,
                email: email,
                property_address: address,
                best_time: bestTime,
                urgency_level: 'emergency',
                lead_source: 'ai_assistant',
                timestamp: new Date().toISOString(),
                ai_situation: document.getElementById('ai-input').value
            };
            
            try {
                // Show loading state
                const button = event.target;
                button.innerHTML = '‚è≥ Scheduling...';
                button.disabled = true;
                
                // Submit to your lead capture system
                const response = await fetch('https://stop-foreclosure-fast.onrender.com/api/ai/emergency-booking', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(appointmentData)
                });
                
                if (response.ok) {
                    // Success - show confirmation
                    document.getElementById('appointment-form').innerHTML = `
                        <div style="background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 12px; padding: 25px; text-align: center;">
                            <h4 style="color: #0369a1; margin: 0 0 15px 0;">üíô You're Not Alone - Help is Coming!</h4>
                            <p style="margin: 15px 0; color: #0369a1; line-height: 1.6;">
                                <strong>We've received your information and one of our caring specialists will call you within 15 minutes at ${phone}</strong><br><br>
                                We know this is a difficult time, and we're honored that you've trusted us to help. Our team is experienced in handling urgent situations just like yours, and we're going to work together to find the best solution for you and your family.
                            </p>
                            <p style="margin: 15px 0; color: #0369a1; font-weight: 600;">
                                Can't wait? You can call us directly:
                            </p>
                            <button onclick="window.open('tel:9493284811')" style="background: #0ea5e9; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">
                                üíô Call Us Now: (949) 328-4811
                            </button>
                        </div>
                    `;
                    
                    // Track successful booking
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'emergency_appointment_booked', {
                            'event_category': 'AI Conversion',
                            'event_label': 'Emergency Consultation Scheduled',
                            'value': 1
                        });
                    }
                } else {
                    throw new Error('Booking failed');
                }
                
            } catch (error) {
                // Fallback - direct call
                document.getElementById('appointment-form').innerHTML = `
                    <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 20px; text-align: center;">
                        <h4 style="color: #dc2626; margin: 0 0 10px 0;">Please Call Immediately</h4>
                        <p style="margin: 10px 0; color: #dc2626;">
                            Your information has been noted. For immediate assistance:
                        </p>
                        <button onclick="window.open('tel:9493284811')" style="background: #dc2626; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                            üìû CALL NOW: (949) 328-4811
                        </button>
                    </div>
                `;
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('ai-assistant-modal');
            if (event.target === modal) {
                closeAIAssistant();
            }
        });

        // Removed automatic popup - users can discover AI assistant organically through navigation or floating button
        
        // Clean, non-intrusive approach - users can find AI assistant when they want it
    </script>

    <!-- Bounce Animation CSS -->
    <style>
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
    </style>

    <!-- AI Integration - Add your Google Cloud Run URL in ai-integration.js -->
    <script src="js/ai-integration.js"></script>
</body>
</html>